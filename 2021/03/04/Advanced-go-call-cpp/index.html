<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Go进阶编程之Go调用C++(Linux) | UXCloudMax</title><meta name="keywords" content="Go语言,C++"><meta name="author" content="UXCloudMax Group,uxcloudmax@163.com"><meta name="copyright" content="UXCloudMax Group"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Go进阶编程之Go调用C++（Linux）环境： Ubuntu 18.04 golang 1.14 linux amd64  一、了解调用流程 c调用c++动态链接库 go通过cgo调用c 从而达到go调用c++，其实是通过c来做中间层转换的功能  go调用c动态库number目录结构 123456root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppi">
<meta property="og:type" content="article">
<meta property="og:title" content="Go进阶编程之Go调用C++(Linux)">
<meta property="og:url" content="https://urmsone.github.io/2021/03/04/Advanced-go-call-cpp/index.html">
<meta property="og:site_name" content="UXCloudMax">
<meta property="og:description" content="Go进阶编程之Go调用C++（Linux）环境： Ubuntu 18.04 golang 1.14 linux amd64  一、了解调用流程 c调用c++动态链接库 go通过cgo调用c 从而达到go调用c++，其实是通过c来做中间层转换的功能  go调用c动态库number目录结构 123456root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppi">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-03-04T13:25:13.000Z">
<meta property="article:modified_time" content="2021-03-04T13:53:46.631Z">
<meta property="article:author" content="UXCloudMax Group">
<meta property="article:tag" content="Go语言">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://urmsone.github.io/2021/03/04/Advanced-go-call-cpp/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-04 21:53:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="UXCloudMax" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">UXCloudMax</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Go进阶编程之Go调用C++(Linux)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-04T13:25:13.000Z" title="发表于 2021-03-04 21:25:13">2021-03-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-04T13:53:46.631Z" title="更新于 2021-03-04 21:53:46">2021-03-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>9分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Go进阶编程之Go调用C-（Linux）"><a href="#Go进阶编程之Go调用C-（Linux）" class="headerlink" title="Go进阶编程之Go调用C++（Linux）"></a>Go进阶编程之Go调用C++（Linux）</h1><h2 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h2><ul>
<li>Ubuntu 18.04</li>
<li>golang 1.14</li>
<li>linux amd64</li>
</ul>
<h2 id="一、了解调用流程"><a href="#一、了解调用流程" class="headerlink" title="一、了解调用流程"></a>一、了解调用流程</h2><ul>
<li>c调用c++动态链接库</li>
<li>go通过cgo调用c</li>
<li>从而达到go调用c++，其实是通过c来做中间层转换的功能</li>
</ul>
<h3 id="go调用c动态库"><a href="#go调用c动态库" class="headerlink" title="go调用c动态库"></a>go调用c动态库</h3><p>number目录结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;number# tree</span><br><span class="line">.</span><br><span class="line">├── libnumber.so</span><br><span class="line">├── main.go</span><br><span class="line">├── number.c</span><br><span class="line">└── number.h</span><br></pre></td></tr></table></figure>
<p>number.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int number_add_mod(int a, int b, int mod);</span><br><span class="line">number.c</span><br><span class="line">#include &quot;number.h&quot;</span><br><span class="line">int number_add_mod(int a, int b, int mod) &#123;</span><br><span class="line">    return (a+b)%mod;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main.go</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">@Author: urmsone urmsone@163.com</span><br><span class="line">@Date: 3&#x2F;4&#x2F;21 10:29 AM</span><br><span class="line">@Name: main.go</span><br><span class="line">@Description:</span><br><span class="line">*&#x2F;</span><br><span class="line">package main</span><br><span class="line">&#x2F;&#x2F;#cgo CFLAGS: -I.&#x2F;</span><br><span class="line">&#x2F;&#x2F;#cgo LDFLAGS: -L$&#123;SRCDIR&#125;&#x2F; -lnumber</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;#include &quot;number.h&quot;</span><br><span class="line">import &quot;C&quot;</span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line">&#x2F;&#x2F; 生成动态链接库</span><br><span class="line">&#x2F;&#x2F; gcc -shared -o libnumber.so number.c</span><br><span class="line">func main() &#123;</span><br><span class="line">	fmt.Println(C.number_add_mod(10, 5, 12))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动态链接库生成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -o libnumber.so number.c</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;number# go build -o main main.go</span><br><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;number# .&#x2F;main</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>如果报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;main: error while loading shared libraries: libnumber.so: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>
<p>是链接时没找到libnumber.so这个库，解决办法，指定链接时搜索的目录即可，其中一个办法如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">步骤：</span><br><span class="line">1）新建文件&#x2F;etc&#x2F;ld.so.conf.d&#x2F;test.conf</span><br><span class="line">2）在文件中指定链接搜索路径</span><br><span class="line">3）保存后执行ldconfig</span><br><span class="line">我的路径设置如下：</span><br><span class="line">root@ubuntu:&#x2F;etc&#x2F;ld.so.conf.d# ldconfig</span><br><span class="line">root@ubuntu:&#x2F;etc&#x2F;ld.so.conf.d# cat test.conf </span><br><span class="line">&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;number</span><br><span class="line">&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;callcppso</span><br></pre></td></tr></table></figure>
<h3 id="c调用c-动态链接库"><a href="#c调用c-动态链接库" class="headerlink" title="c调用c++动态链接库"></a>c调用c++动态链接库</h3><p>ccallcpp目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;ccallcpp# tree</span><br><span class="line">.</span><br><span class="line">├── libperson.so</span><br><span class="line">├── main.go</span><br><span class="line">├── Makefile</span><br><span class="line">├── person.cpp</span><br><span class="line">├── person.h</span><br><span class="line">├── wrapper.cpp</span><br><span class="line">└── wrapper.h</span><br></pre></td></tr></table></figure>
<p>person.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#ifndef PERSON_H_</span><br><span class="line">#define PERSON_H_</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">class Person &#123;</span><br><span class="line"> public:</span><br><span class="line">  Person(std::string name, int age);</span><br><span class="line">  ~Person() &#123;&#125;</span><br><span class="line">  const char *GetName() &#123; return name_.c_str(); &#125;</span><br><span class="line">  int GetAge() &#123; return age_; &#125;</span><br><span class="line"> private:</span><br><span class="line">  std::string name_;</span><br><span class="line">  int age_;</span><br><span class="line">&#125;;</span><br><span class="line">#endif &#x2F;&#x2F; PERSON_H_</span><br></pre></td></tr></table></figure>
<p>person.cpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;person.h&quot;</span><br><span class="line">Person::Person(std::string name, int age)</span><br><span class="line">    : name_(name), age_(age) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>由于c没有类的概念，因此需要写一个wrapper把c++中的类转成c的函数来调用<br>wrapper.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#ifndef WRAPPER_H_</span><br><span class="line">#define WRAPPER_H_</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern &quot;C&quot;</span><br><span class="line">&#123;</span><br><span class="line">#endif</span><br><span class="line">void *call_Person_Create();</span><br><span class="line">void call_Person_Destroy(void *);</span><br><span class="line">int call_Person_GetAge(void *);</span><br><span class="line">const char *call_Person_GetName(void *);</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">#endif &#x2F;&#x2F; WRAPPER_H_</span><br></pre></td></tr></table></figure>
<p>wrapper.cpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;person.h&quot;</span><br><span class="line">#include &quot;wrapper.h&quot;</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line">#endif</span><br><span class="line">void *call_Person_Create() &#123;</span><br><span class="line">  return new Person(&quot;urmsone&quot;, 18);</span><br><span class="line">&#125;</span><br><span class="line">void call_Person_Destroy(void *p) &#123;</span><br><span class="line">  delete static_cast&lt;Person *&gt;(p);</span><br><span class="line">&#125;</span><br><span class="line">int call_Person_GetAge(void *p) &#123;</span><br><span class="line">  return static_cast&lt;Person *&gt;(p)-&gt;GetAge();</span><br><span class="line">&#125;</span><br><span class="line">const char *call_Person_GetName(void *p) &#123;</span><br><span class="line">  return static_cast&lt;Person *&gt;(p)-&gt;GetName();</span><br><span class="line">&#125;</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>main.go</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">@Author: urmsone urmsone@163.com</span><br><span class="line">@Date: 3&#x2F;4&#x2F;21 1:53 PM</span><br><span class="line">@Name: main.go</span><br><span class="line">@Description:</span><br><span class="line">*&#x2F;</span><br><span class="line">package main</span><br><span class="line">&#x2F;*</span><br><span class="line">#cgo CFLAGS: -I .&#x2F;</span><br><span class="line">#cgo LDFLAGS: -L.&#x2F; -lperson</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;wrapper.h&quot;</span><br><span class="line">*&#x2F;</span><br><span class="line">import &quot;C&quot;</span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">	person :&#x3D; C.call_Person_Create()</span><br><span class="line">	defer C.call_Person_Destroy(person)</span><br><span class="line">	age :&#x3D; C.call_Person_GetAge(person)</span><br><span class="line">	fmt.Println(age)</span><br><span class="line">	&#x2F;&#x2F;defer C.free(unsafe.Pointer(age))</span><br><span class="line">	name :&#x3D; C.call_Person_GetName(person)</span><br><span class="line">	&#x2F;&#x2F;defer C.free(unsafe.Pointer(name))</span><br><span class="line">	fmt.Println(C.GoString(name))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成动态库，动态库的位置和名字要于main函数中的<code>cgo LDFLAGS: -L./ -lperson</code>对应；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ person.cpp wrapper.cpp -fPIC -shared -o libperson.so</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://chai2010.cn/advanced-go-programming-book/ch2-cgo/ch2-02-basic.html">Go语言高级编程</a><br>提到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CFLAGS部分，-I定义了头文件包含的检索目录。LDFLAGS部分，-L指定了链接时库文件检索目录，-l指定了链接时需要链接person库。</span><br><span class="line">因为C&#x2F;C++遗留的问题，C头文件检索目录可以是相对目录，但是库文件检索目录则需要绝对路径。在库文件的检索目录中可以通过$&#123;SRCDIR&#125;变量表示当前包目录的绝对路径：</span><br><span class="line">&#x2F;&#x2F; #cgo LDFLAGS: -L$&#123;SRCDIR&#125;&#x2F;libs -lfoo</span><br></pre></td></tr></table></figure>
<p>但我这里使用的是相对路径，也没出问题。</p>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;ccallcpp# g++ person.cpp wrapper.cpp -fPIC -shared -o libperson.so</span><br><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;ccallcpp# go build -o main main.go </span><br><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;ccallcpp# .&#x2F;main </span><br><span class="line">.&#x2F;main: error while loading shared libraries: libperson.so: cannot open shared object file: No such file or directory</span><br><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callso&#x2F;ccallcpp# .&#x2F;main </span><br><span class="line">18</span><br><span class="line">urmsone</span><br></pre></td></tr></table></figure>
<p><strong>流程：go-&gt;cgo-&gt;c-&gt;wrapper-c++</strong></p>
<h2 id="二、回调"><a href="#二、回调" class="headerlink" title="二、回调"></a>二、回调</h2><p>###描述<br>主要记录一个常用的场景，参考官网<a target="_blank" rel="noopener" href="https://github.com/golang/go/wiki/cgo#function-pointer-callbacks">链接</a> ，描述如下：<br>go调用c/c++的某个函数A（c/c++语言实现），然后把go语言实现的函数B作为参数传递给函数A，在执行函数A的过程中调用函数B。这个流程包含了go调用c/c++，和c/c++调用go两种情况。<br>调用过程：Go.main -&gt; C.A -&gt; Go.B<br>###场景：<br>go需要调用原生C++动态链接库，而动态库中某个函数A需要接收《函数指针》变量最为参数，通过《函数指针》来调用回调函数。当go调用函数A时，需要传递一个go语言实现的函数，并把该函数的指针传递给A。</p>
<p>###实现<br>ccallbackgo目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callbackso&#x2F;ccallbackgo# tree</span><br><span class="line">.</span><br><span class="line">├── cfunc.go</span><br><span class="line">├── clibrary.c</span><br><span class="line">├── clibrary.h</span><br><span class="line">├── libclibrary.so</span><br><span class="line">└── main.go</span><br></pre></td></tr></table></figure>
<p>clibrary.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 定义函数some_c_func和</span><br><span class="line">&#x2F;&#x2F; 函数指针（简单理解为回调函数的地址，通过该地址可之间调用回调函数）</span><br><span class="line">#ifndef CLIBRARY_H</span><br><span class="line">#define CLIBRARY_H</span><br><span class="line">typedef int (*callback_fcn)(int);</span><br><span class="line">void some_c_func(callback_fcn);</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>clibrary.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 实现some_c_func函数</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;clibrary.h&quot;</span><br><span class="line">void some_c_func(callback_fcn callback)&#123;</span><br><span class="line">    int arg &#x3D; 2;</span><br><span class="line">    printf(&quot;C.some_c_func(): calling callback with arg &#x3D;%d\n&quot;, arg);</span><br><span class="line">    int response &#x3D; callback(2);</span><br><span class="line">    printf(&quot;C.some_c_func(): callback response with %d\n&quot;, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main.go</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">@Author: urmsone urmsone@163.com</span><br><span class="line">@Date: 3&#x2F;4&#x2F;21 7:37 PM</span><br><span class="line">@Name: main.go</span><br><span class="line">@Description:</span><br><span class="line">1）在注释中声明回调函数callOnMeGo_cgo（该名字应与网关函数同名）</span><br><span class="line">2）实现回调函数,通过cgo的export callOnMeGo注释导出</span><br><span class="line">3）编写网关函数</span><br><span class="line">*&#x2F;</span><br><span class="line">package main</span><br><span class="line">&#x2F;*</span><br><span class="line">#cgo CFLAGS: -I .</span><br><span class="line">#cgo LDFLAGS: -L . -lclibrary</span><br><span class="line">#include &quot;clibrary.h&quot;</span><br><span class="line">int callOnMeGo_cgo(int in); &#x2F;&#x2F; Forward declaration.</span><br><span class="line">*&#x2F;</span><br><span class="line">import &quot;C&quot;</span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;unsafe&quot;</span><br><span class="line">)</span><br><span class="line">&#x2F;&#x2F;export callOnMeGo</span><br><span class="line">func callOnMeGo(in int) int &#123;</span><br><span class="line">	fmt.Printf(&quot;Go.callOnMeGo(): called with arg &#x3D; %d\n&quot;, in)</span><br><span class="line">	return in + 1</span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line">	fmt.Printf(&quot;Go.main(): calling C function with callback to us\n&quot;)</span><br><span class="line">        &#x2F;&#x2F; C.callOnMeGo_cgo为注释中声明的回调函数名（网关函数名）</span><br><span class="line">        &#x2F;&#x2F; some_c_func里面的涵义是，先把C.callOnMeGo_cgo函数转成指针</span><br><span class="line">        &#x2F;&#x2F; 再通过C.callback_fcn把指针类型转成回调指针函数的类型</span><br><span class="line">	C.some_c_func((C.callback_fcn)(unsafe.Pointer(C.callOnMeGo_cgo)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>cfunc.go</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">@Author: urmsone urmsone@163.com</span><br><span class="line">@Date: 3&#x2F;4&#x2F;21 7:45 PM</span><br><span class="line">@Name: cfunc.go</span><br><span class="line">@Description:</span><br><span class="line">*&#x2F;</span><br><span class="line">package main</span><br><span class="line">&#x2F;*</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">&#x2F;&#x2F; The gateway function</span><br><span class="line">int callOnMeGo_cgo(int in)&#123;</span><br><span class="line">	printf(&quot;C.callOnMeGo_cgo(): called with arg &#x3D; %d\n&quot;, in);</span><br><span class="line">	int callOnMeGo(int);</span><br><span class="line">	return callOnMeGo(in);</span><br><span class="line">&#125;</span><br><span class="line">*&#x2F;</span><br><span class="line">import &quot;C&quot;</span><br></pre></td></tr></table></figure>
<p>生成动态链接库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -o libclibrary.so clibrary.c</span><br><span class="line"></span><br><span class="line">运行</span><br><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callbackso&#x2F;ccallbackgo# go build -o main *.go</span><br><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callbackso&#x2F;ccallbackgo# .&#x2F;main</span><br><span class="line">Go.main(): calling C function with callback to us</span><br><span class="line">C.some_c_func(): calling callback with arg &#x3D;2</span><br><span class="line">C.callOnMeGo_cgo(): called with arg &#x3D; 2</span><br><span class="line">Go.callOnMeGo(): called with arg &#x3D; 2</span><br><span class="line">C.some_c_func(): callback response with 3</span><br><span class="line">注意：要把网关函数一起build，否则会报错</span><br><span class="line">root@ubuntu:&#x2F;workspace&#x2F;gospace&#x2F;cppingo&#x2F;callbackso&#x2F;ccallbackgo# go build -o main main.go </span><br><span class="line"># command-line-arguments</span><br><span class="line">&#x2F;tmp&#x2F;go-build285429389&#x2F;b001&#x2F;_cgo_main.o:&#x2F;tmp&#x2F;go-build&#x2F;cgo-generated-wrappers:2: undefined reference to &#96;callOnMeGo_cgo&#39;</span><br></pre></td></tr></table></figure>
<h3 id="三、内存管理"><a href="#三、内存管理" class="headerlink" title="三、内存管理"></a>三、内存管理</h3><ul>
<li>go调c++<ul>
<li>何时释放由c/c++开辟的内存空间</li>
</ul>
</li>
<li>c++调go<ul>
<li>何时释放go回调回来由go创建的对象（go有GC，可能c/c++ keep住的对象已被GC回收，导致内存地址invalid）</li>
</ul>
</li>
</ul>
<h3 id="四、c-语法学习"><a href="#四、c-语法学习" class="headerlink" title="四、c++语法学习"></a>四、c++语法学习</h3><p>将c++类转成c函数调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void *call_Person_Create() &#123;</span><br><span class="line">  return new Person(&quot;urmsone&quot;, 18);</span><br><span class="line">&#125;</span><br><span class="line">void call_Person_Destroy(void *p) &#123;</span><br><span class="line">  delete static_cast&lt;Person *&gt;(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>void *call_Person_Create() </code>是一个指针函数，返回c++中Person类对象的指针，指针类型为void（因为c中没有c++中Person类对应的类型，所以类型为void）。</p>
<p>这里涉及到c++类型转换符，static_cast,const_cast,reinterpret_cast,dynamic_cast<br>static_cast&lt;Person *&gt;(p)</p>
<p>回调类型：<code>typedef void (*EnvSDK_Callback)(int, const char*, void*);</code></p>
<h3 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a>代码仓库</h3><p><a target="_blank" rel="noopener" href="https://github.com/UrmsOne/cppingo">源码仓库</a></p>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><p><a target="_blank" rel="noopener" href="https://chai2010.cn/advanced-go-programming-book/">Go语言高级编程-gitbook</a>  </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:uxcloudmax@163.com">UXCloudMax Group</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://urmsone.github.io/2021/03/04/Advanced-go-call-cpp/">https://urmsone.github.io/2021/03/04/Advanced-go-call-cpp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://urmsone.github.io" target="_blank">UXCloudMax</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Go%E8%AF%AD%E8%A8%80/">Go语言</a><a class="post-meta__tags" href="/tags/C/">C++</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2021/03/04/hello-world/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hello World</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/null" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">UXCloudMax Group</div><div class="author-info__description">拥抱云原生,过云上的日子</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/urmsone"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/urmsone" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:urmsone@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Go%E8%BF%9B%E9%98%B6%E7%BC%96%E7%A8%8B%E4%B9%8BGo%E8%B0%83%E7%94%A8C-%EF%BC%88Linux%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">Go进阶编程之Go调用C++（Linux）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">环境：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BA%86%E8%A7%A3%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">一、了解调用流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#go%E8%B0%83%E7%94%A8c%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-number">1.2.1.</span> <span class="toc-text">go调用c动态库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c%E8%B0%83%E7%94%A8c-%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">1.2.2.</span> <span class="toc-text">c调用c++动态链接库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%9B%9E%E8%B0%83"><span class="toc-number">1.3.</span> <span class="toc-text">二、回调</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">三、内存管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81c-%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.3.2.</span> <span class="toc-text">四、c++语法学习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93"><span class="toc-number">1.3.3.</span> <span class="toc-text">代码仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A"><span class="toc-number">1.3.4.</span> <span class="toc-text">参考：</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/03/04/hello-world/" title="Hello World"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2021/03/04/hello-world/" title="Hello World">Hello World</a><time datetime="2021-03-04T13:30:08.442Z" title="发表于 2021-03-04 21:30:08">2021-03-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/04/Advanced-go-call-cpp/" title="Go进阶编程之Go调用C++(Linux)"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go进阶编程之Go调用C++(Linux)"/></a><div class="content"><a class="title" href="/2021/03/04/Advanced-go-call-cpp/" title="Go进阶编程之Go调用C++(Linux)">Go进阶编程之Go调用C++(Linux)</a><time datetime="2021-03-04T13:25:13.000Z" title="发表于 2021-03-04 21:25:13">2021-03-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By UXCloudMax Group</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '1ec32308a20fa4b2d380',
      clientSecret: '8505c26b5e61bd73ac1773dfc938c7294c61bc47',
      repo: 'gitalk.comment',
      owner: 'urmsone',
      admin: ['urmsone'],
      id: '9970696258c0da3233757965674ba09c',
      language: 'en',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount,
      proxy: 'https://shielded-brushlands-08810.herokuapp.com/https://github.com/login/oauth/access_token',
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>